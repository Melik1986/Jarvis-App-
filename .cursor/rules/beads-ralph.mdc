---
description: Правила работы с системой Beads (менеджер задач) и Ralph (автономный исполнитель). Используются для автоматизации разработки и управления задачами проекта.
globs: ["**/server/modules/beads/**", "**/beads/**", "**/ralph/**"]
alwaysApply: false
---

# Beads + Ralph — Автономная система управления задачами

## Архитектура

| Компонент | Роль | Файлы |
|-----------|------|-------|
| **Beads** | Менеджер задач — создание, приоритизация, контроль | `beads.service.ts` |
| **Ralph** | Автономный исполнитель — циклы выполнения | `ralph.service.ts` |
| **RulesParser** | Парсер .cursor/rules и .cursor/skills | `rules-parser.ts` |

## Интеграция с .cursor/

### Автоматический контекст

При создании задачи Beads автоматически:
1. Сканирует `.cursor/rules/*.mdc` для поиска релевантных правил
2. Сканирует `.cursor/skills/*/SKILL.md` для поиска релевантного skill
3. Извлекает ключевые guidelines из правил
4. Связывает задачу с контекстом проекта

### Ralph использует контекст

При выполнении задачи Ralph:
1. Загружает связанные правила и skill
2. Строит execution prompt с guidelines
3. Следует правилам проекта автоматически

## API

### Beads (Task Management)

```
GET  /api/beads/context          — Получить rules + skills
GET  /api/beads/tasks            — Все задачи
GET  /api/beads/tasks/:id        — Задача по ID
GET  /api/beads/tasks/:id/context — Контекст задачи (rules, skill)
POST /api/beads/tasks            — Создать задачу
POST /api/beads/tasks/plan       — Создать задачи из плана
PATCH /api/beads/tasks/:id/status — Обновить статус
GET  /api/beads/summary          — Сводка по задачам
```

### Ralph (Execution)

```
POST /api/ralph/execute/:taskId  — Выполнить задачу
POST /api/ralph/execute-all      — Выполнить все pending
POST /api/ralph/stop             — Остановить выполнение
GET  /api/ralph/cycles           — Активные циклы
GET  /api/ralph/cycles/:id/logs  — Логи цикла
GET  /api/ralph/next-task        — Следующая задача
```

## Создание задач

### Приоритеты

- `critical` — блокирует релиз, выполнять немедленно
- `high` — важно для текущего спринта
- `medium` — стандартный приоритет
- `low` — nice-to-have

### Статусы

- `pending` — ожидает выполнения
- `in_progress` — выполняется Ralph
- `completed` — завершено успешно
- `blocked` — заблокировано зависимостью
- `cancelled` — отменено

### Пример создания задачи

```typescript
await beadsService.createTask({
  title: "Добавить Function Calling для get_stock",
  description: "Интегрировать 1С модуль в chat через Function Calling",
  priority: "high",
  criteria: [
    "LLM вызывает get_stock при вопросе об остатках",
    "Результат возвращается в чат",
    "Работает с mock-данными без 1С"
  ],
  targetFiles: ["server/replit_integrations/chat/routes.ts"]
});
```

### Пример плана

```typescript
await beadsService.createTasksFromPlan([
  {
    title: "Создать модуль 1С",
    description: "OData клиент для 1С",
    priority: "critical"
  },
  {
    title: "Добавить Function Calling",
    description: "Интеграция в chat",
    priority: "high",
    dependsOn: ["Создать модуль 1С"]
  }
]);
```

## Ralph Execution

### Цикл выполнения

1. Beads даёт задачу Ralph
2. Ralph загружает контекст (rules + skill)
3. Ralph строит prompt с guidelines
4. Ralph выполняет с AI assistance
5. Ralph возвращает результат в Beads
6. Beads обновляет статус и разблокирует зависимые

### Логирование

Все действия Ralph логируются в `RalphCycle.logs`:
- `info` — основные события
- `warn` — предупреждения
- `error` — ошибки
- `debug` — детали для отладки

## Связь с проектом JSRVIS

Beads + Ralph используют:
- `project-context.mdc` для понимания модулей проекта
- `tech-stack-expert.mdc` для технических практик
- `jarvis-1c-project` skill для контекста 1С интеграции

При работе с задачами по 1С, RAG, Auth — система автоматически подтягивает релевантные правила.
