---
description: Сабагент для внутреннего агента Cursor — MCP и сторонние сервисы/библиотеки. Вызывать при работе с браузером, n8n, Supabase, Figma, Railway, Vercel, ECS, Context7, Linear, Playwright, Chrome DevTools и др.
globs: []
alwaysApply: true
---

# MCP Tools Subagent (для агента в редакторе)

Внутренний агент при работе с **MCP и сторонними сервисами/библиотеками** действует по этому сабагенту. Вызов инструментов и ресурсов через MCP-серверы (в т.ч. JSRVIS 1C — project-context).

## Когда активировать

- Пользователь просит что-то сделать через MCP, браузер, n8n, Supabase, Figma, Railway, Vercel, AWS ECS, документацию (Context7), Linear, Playwright, Chrome DevTools, Console Ninja.
- Задача требует вызова внешнего инструмента из списка доступных MCP-серверов.

## Обязательный порядок работы с инструментами

1. **Перед вызовом любого MCP-инструмента** — прочитать схему:
   - Дескрипторы: `mcps/<server>/tools/<tool-name>.json` (параметры, типы, описание).
   - Не вызывать `call_mcp_tool` без проверки схемы — иначе возможны ошибки аргументов.

2. **Вызов**: `call_mcp_tool(server, toolName, arguments)` — передавать только параметры из схемы, в нужных типах.

3. **Ресурсы MCP** (если нужны данные от сервера):
   - Список: `list_mcp_resources` (или просмотр `mcps/<server>/resources/*.json`).
   - Получить контент: `fetch_mcp_resource(server, uri)`.

## Сервер-специфичные инструкции

Соблюдать **server use instructions** из системного контекста для каждого сервера, например:

- **cursor-ide-browser**: lock/unlock — сначала `browser_navigate` (или проверить вкладки), затем `browser_lock`; взаимодействия только после lock; в конце `browser_unlock`. Перед кликом/вводом — `browser_snapshot` для refs. Ожидание — короткие шаги (1–3 с) + snapshot, а не один длинный wait.
- **user-awslabs.ecs-mcp-server**: Express Mode — порядок containerize → build_and_push → validate_ecs_express_mode_prerequisites → ecs_resource_management(CreateExpressGatewayService). После деплоя явно сообщать пользователю URL приложения.
- Остальные серверы: при необходимости смотреть `mcps/<server>/INSTRUCTIONS.md` или метаданные.

## Краткий список MCP-серверов (проект)

| Сервер | Назначение |
|--------|------------|
| cursor-ide-browser | Навигация и автоматизация в браузере |
| user-supabase | Проекты, SQL, миграции, Edge Functions |
| user-n8n / user-n8n-docs | Воркфлоу, шаблоны, документация n8n |
| user-Context7 | Актуальная документация и примеры по библиотекам |
| user-Railway, user-Vercel | Деплой и конфигурация |
| user-awslabs.ecs-mcp-server | ECS, контейнеры, Express Mode |
| user-Figma, user-Linear | Дизайн и задачи (по статусу сервера) |
| user-Playwright, user-chrome-devtools | E2E и отладка браузера |
| user-console-ninja | Runtime-логи и ошибки |

## Связь с проектом

- В JSRVIS 1C MCP используется для подключаемых источников (Sheets, PostgreSQL, ERP).
- При интеграциях и подсказках по коду учитывать project-context и AI Adapter Pattern; MCP-инструменты — часть экосистемы агента.
